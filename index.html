<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="description" content="Daily diabetes log PWA. Meals, medications, blood sugar, sleep, and chart with A4 export." />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
  <title>Diabetes Daily Log</title>
</head>
<body>
  <header class="app-header">
    <h1 id="t_app_title">Diabetes Daily Log</h1>
    <div class="status">
      <select id="langSel" class="btn small selectlike">
        <option value="en">English</option>
        <option value="fa">ŸÅÿßÿ±ÿ≥€å</option>
      </select>
      <span id="netStatus" class="badge">Offline</span>
      <button id="installBtn" class="btn small" hidden>Install</button>
    </div>
  </header>

  <main>
    <!-- 8) Daily Rules (moved to top) -->
    <section class="card">
      <h2 id="t_rules_title">Daily Rules</h2>
      <ul id="rulesList">
        <li id="t_rule_bf">Before <b>09:00</b> ‚Äî eat breakfast and take diabetes medications.</li>
        <li id="t_rule_ln">Before <b>14:00</b> ‚Äî eat lunch and take diabetes medications.</li>
        <li id="t_rule_dn">Before <b>21:00</b> ‚Äî eat dinner and take diabetes medications.</li>
      </ul>
    </section>

    <!-- 1) Select Day (no units) -->
    <section class="card">
      <h2 id="t_select_day">Select Day</h2>
      <div class="grid three">
        <label id="t_greg_label">Date (Gregorian)
          <div class="row">
            <button id="prevDay" class="btn small secondary">&larr;</button>
            <div class="row">  <input id="dayDate" type="date" />  <button id="openCal" class="btn small secondary" type="button" title="Open calendar">üìÖ</button></div>
<div id="gregFallback" class="row hidden">  <select id="gYear"></select>  <select id="gMonth"></select>  <select id="gDay"></select></div>
            <button id="nextDay" class="btn small secondary">&rarr;</button>
          </div>
        </label>
        <label id="t_jalali_label">Date (Persian)
          <div class="row">
            <div id="jalaliOut" class="jalali-out">‚Äî</div>
          </div>
        </label>
        <label id="t_daytext_label">Day (optional text)
          <input id="dayText" type="text" placeholder="Saturday / Week 2" />
        </label>
      </div>
      <div class="actions">
        <button id="copyPrev" class="btn secondary" data-i18n="copy_prev">Copy previous day</button>
        <button id="clearDay" class="btn danger" data-i18n="clear_day">Clear day</button>
      </div>
      <small class="muted" id="t_pick_hint">Pick a date to load/save that day‚Äôs data.</small>
    </section>

    <!-- 2) Meals -->
    <section class="card">
      <h2 id="t_meals">Meals</h2>
      <div class="actions">
        <button id="addMeal" class="btn" data-i18n="add_meal">+ Add meal</button>
      </div>
      <ul id="mealsList" class="list"></ul>
      <template id="mealTpl">
        <li class="item meal">
          <div class="entry">
            <div class="grid three">
              <label data-i18n="kind">Kind
                <select class="meal-kind">
                  <option value="Breakfast">Breakfast</option>
                  <option value="Snack">Snack</option>
                  <option value="Lunch">Lunch</option>
                  <option value="Snack (Afternoon)">Snack (Afternoon)</option>
                  <option value="Dinner">Dinner</option>
                  <option value="Other">Other</option>
                </select>
              </label>
              <label data-i18n="time">Time
                <input type="time" class="meal-time" />
              </label>
              <label data-i18n="details">Details
                <textarea class="meal-desc" rows="2" placeholder="100 g bread&#10;30 g cheese&#10;1 cup coffee"></textarea>
              </label>
            </div>
          </div>
          <button class="del">Delete</button>
        </li>
      </template>
    </section>

    <!-- 3) Medications -->
    <section class="card">
      <h2 id="t_meds">Medications</h2>
      <div class="actions">
        <button id="addMed" class="btn" data-i18n="add_med">+ Add medication</button>
      </div>
      <ul id="medsList" class="list"></ul>
      <template id="medTpl">
        <li class="item med">
          <div class="entry">
            <div class="grid two">
              <label data-i18n="time">Time
                <input type="time" class="med-time" />
              </label>
              <label data-i18n="drugs_dose">Drugs &amp; dose
                <textarea class="med-desc" rows="2" placeholder="18 Novorapid&#10;20 Regular&#10;Sita-Met 12.5/1000"></textarea>
              </label>
            </div>
          </div>
          <button class="del">Delete</button>
        </li>
      </template>
    </section>

    <!-- 4) Blood Sugar -->
    <section class="card">
      <h2 id="t_sugars">Blood Sugar</h2>
      <div class="actions">
        <button id="addSugar" class="btn" data-i18n="add_bs_custom">+ Add custom reading</button>
        <button id="addTemplate" class="btn secondary" data-i18n="use_recommended">Use recommended times</button>
      </div>
      <ul id="sugarList" class="list"></ul>
      <template id="sugarTpl">
        <li class="item sugar">
          <div class="entry">
            <div class="grid three">
              <label data-i18n="label">Label
                <input type="text" class="sugar-label" placeholder="Fasting / After BF 2h / ..." />
              </label>
              <label data-i18n="time">Time
                <input type="time" class="sugar-time" />
              </label>
              <label data-i18n="value">Value (mg/dL)
                <input type="number" min="10" max="1000" inputmode="decimal" class="sugar-value" placeholder="mg/dL" />
              </label>
            </div>
            <small class="muted warn"></small>
          </div>
          <button class="del">Delete</button>
        </li>
      </template>
      <small class="muted" id="t_rec_hint">Recommended: Fasting (after wake), 2h after breakfast, 12:00, 18:00, Before sleep.</small>
    </section>

    <!-- 5) Sleep -->
    <section class="card">
      <h2 id="t_sleep">Sleep</h2>
      <div class="grid two">
        <label id="t_wake">Wake time
          <input id="wakeTime" type="time" />
        </label>
        <label id="t_bed">Bed time
          <input id="sleepTime" type="time" />
        </label>
      </div>
    </section>

    <!-- 6) Chart / 7) Export -->
    <section class="card">
      <h2 id="t_chart">Daily Chart</h2>
      <canvas id="chart" width="1100" height="540" class="chart"></canvas>
      <div class="actions">
        <button id="redraw" class="btn secondary" data-i18n="redraw">Redraw Chart</button>
        <button id="exportA4" class="btn" data-i18n="export_a4">Export A4 (Landscape)</button>
      </div>
      <small class="muted" id="t_target_band">Shaded band = 70‚Äì180 mg/dL target range.</small>
    </section>
  </main>

  <footer>
    <small id="t_footer">Works offline after first load. You can install it: open menu ‚ãÆ ‚Üí <b>Install app</b> (Android Chrome).</small>
  </footer>

  <script src="app.js" defer></script>

<!-- Custom calendar modal -->
<div id="calModal" class="modal hidden" aria-hidden="true" role="dialog">
  <div class="modal-backdrop" data-close></div>
  <div class="modal-card" role="document" aria-label="Calendar">
    <div class="modal-header">
      <button id="calPrev" class="btn small secondary" type="button">‚óÄ</button>
      <div id="calTitle" class="modal-title">Month YYYY</div>
      <button id="calNext" class="btn small secondary" type="button">‚ñ∂</button>
    </div>
    <div class="cal-grid">
      <div class="cal-dow">Sun</div><div class="cal-dow">Mon</div><div class="cal-dow">Tue</div><div class="cal-dow">Wed</div><div class="cal-dow">Thu</div><div class="cal-dow">Fri</div><div class="cal-dow">Sat</div>
      <div id="calDays" class="cal-days"></div>
    </div>
    <div class="modal-actions">
      <button id="calToday" class="btn secondary" type="button">Today</button>
      <button id="calClose" class="btn" type="button">Close</button>
    </div>
  </div>
</div>

</body>
</html>
