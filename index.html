<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="description" content="Offline-first Diabetes Day Log (PWA). Track meals, meds, sugars, sleep, and export an A4 chart." />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
  <title>Diabetes Day Log (PWA)</title>
</head>
<body>
  <header class="app-header">
    <h1>Diabetes Day Log</h1>
    <div class="status">
      <span id="netStatus" class="badge">Offline</span>
      <button id="installBtn" class="btn small" hidden>Install</button>
    </div>
  </header>

  <main>
    <!-- 1) Day & Date -->
    <section class="card">
      <h2>Day</h2>
      <div class="row">
        <label>Date
          <input id="dayDate" type="date" required />
        </label>
        <label>Day of week
          <input id="dayName" type="text" disabled />
        </label>
        <div class="spacer"></div>
        <button class="btn secondary" id="clearDayBtn" title="Clear all data for this day">Clear This Day</button>
      </div>
    </section>

    <!-- 2) Meals -->
    <section class="card">
      <div class="between">
        <h2>Meals</h2>
        <button class="btn" id="addMealBtn">+ Add meal</button>
      </div>
      <div class="muted small">Example: breakfast · 08:00 · "100 g bread + 2 eggs + tea"</div>
      <ul id="mealsList" class="list"></ul>
    </section>

    <!-- 3) Medications -->
    <section class="card">
      <div class="between">
        <h2>Medications</h2>
        <button class="btn" id="addMedBtn">+ Add medication</button>
      </div>
      <div class="muted small">Example: 08:00 · "18 Novorapid — 20 Regular — Sita/Met 12.5–1000"</div>
      <ul id="medsList" class="list"></ul>
    </section>

    <!-- 4) Blood sugar -->
    <section class="card">
      <div class="between">
        <h2>Blood sugar</h2>
        <button class="btn" id="addSugarBtn">+ Add reading</button>
      </div>
      <div class="muted small">Preset times: fasting (wake), +2h breakfast, 12:00, 18:00, before sleep</div>
      <div class="quick-times" id="quickTimes"></div>
      <ul id="sugarsList" class="list"></ul>
    </section>

    <!-- 5) Sleep/Wake -->
    <section class="card">
      <h2>Sleep</h2>
      <div class="row">
        <label>Wake-up time
          <input id="wakeTime" type="time" />
        </label>
        <label>Bedtime
          <input id="sleepTime" type="time" />
        </label>
        <div class="spacer"></div>
        <button class="btn secondary" id="saveMetaBtn">Save</button>
      </div>
    </section>

    <!-- 6) Chart -->
    <section class="card">
      <div class="between">
        <h2>Blood sugar chart (mg/dL)</h2>
        <div class="row" style="gap:8px">
          <label class="small">Y max
            <input id="yMax" type="number" min="100" max="600" value="300" style="width:90px" />
          </label>
          <button class="btn secondary small" id="refreshChartBtn">Refresh</button>
        </div>
      </div>
      <canvas id="chart" width="1000" height="420" class="chart"></canvas>
      <div class="muted small">X-axis = time (00:00–24:00). Y-axis = mg/dL. Blue line connects today's readings.</div>
    </section>

    <!-- 7) Export -->
    <section class="card">
      <div class="between">
        <h2>Export A4 (landscape)</h2>
        <button class="btn" id="exportBtn">Export / Print</button>
      </div>
      <div class="muted small">Exports a full-page line chart as the background. Meals & meds appear as boxes placed at their times.</div>
    </section>

    <!-- 8) Rules -->
    <section class="card">
      <h2>Daily Rules</h2>
      <ul class="rules">
        <li>Before <b>09:00</b>: eat breakfast and take diabetes meds.</li>
        <li>Before <b>14:00</b>: eat lunch and take diabetes meds.</li>
        <li>Before <b>21:00</b>: eat dinner and take diabetes meds.</li>
      </ul>
    </section>
  </main>

  <!-- Templates for add-rows -->
  <template id="mealRow">
    <li class="item edit">
      <div class="grid3">
        <label>Time
          <input type="time" class="m-time" required>
        </label>
        <label>Kind
          <select class="m-kind">
            <option>Breakfast</option>
            <option>Lunch</option>
            <option>Dinner</option>
            <option>Snack</option>
            <option>Other</option>
          </select>
        </label>
        <label>Description
          <input type="text" class="m-desc" placeholder="100 g bread + 2 eggs + tea">
        </label>
      </div>
      <div class="actions">
        <button class="btn small save">Save</button>
        <button class="btn secondary small cancel">Cancel</button>
      </div>
    </li>
  </template>

  <template id="medRow">
    <li class="item edit">
      <div class="grid3">
        <label>Time
          <input type="time" class="d-time" required>
        </label>
        <label>Medication(s)
          <input type="text" class="d-desc" placeholder="e.g., 18 Novorapid — 20 Regular — Sita/Met 12.5–1000">
        </label>
        <div></div>
      </div>
      <div class="actions">
        <button class="btn small save">Save</button>
        <button class="btn secondary small cancel">Cancel</button>
      </div>
    </li>
  </template>

  <template id="sugarRow">
    <li class="item edit">
      <div class="grid3">
        <label>Time
          <input type="time" class="s-time" required>
        </label>
        <label>Blood sugar (mg/dL)
          <input type="number" class="s-val" min="10" max="1000" required placeholder="e.g., 170">
        </label>
        <label>Note
          <input type="text" class="s-note" placeholder="fasting, +2h breakfast, noon ...">
        </label>
      </div>
      <div class="actions">
        <button class="btn small save">Save</button>
        <button class="btn secondary small cancel">Cancel</button>
      </div>
    </li>
  </template>

  <!-- Print-only A4 area -->
  <section id="printArea">
    <div id="printCanvasWrap">
      <canvas id="printChart" width="3508" height="2480"></canvas> <!-- A4 landscape @300dpi -->
      <div id="overlay"></div>
    </div>
  </section>

  <footer>
    <small>Install this as an app: open menu ⋮ → <b>Install app</b> (Android Chrome). Works offline after first load.</small>
  </footer>

  <script src="app.js" defer></script>
</body>
</html>
